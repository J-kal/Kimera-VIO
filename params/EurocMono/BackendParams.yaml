%YAML:1.0

# Backend modality for regular VIO
# 0: Structureless factors only, 4: SPR pipeline
backend_modality: 0


#INITIALIZATION PARAMETERS
autoInitialize: 1
roundOnAutoInitialize: 0
initialPositionSigma: 1e-05
initialRollPitchSigma: 0.174533 # 10.0/180.0*M_PI
initialYawSigma: 0.00174533 # 0.1/180.0*M_PI
initialVelocitySigma: 0.001
initialAccBiasSigma: 0.1
initialGyroBiasSigma: 0.01

# VISION PARAMETERS ###########################################################
## Smart Factors ##
#
# How to linearize the factor:
# 0: Hessian, 1: Implicit Schur, 2:Jacobian_Q, 3:Jacobian_SVD
linearizationMode: 0
# How to manage degeneracy
# 0: Ignore degeneracy, 1: Zero on degeneracy, 2: handle infinity
degeneracyMode: 1
# rankTolerance: threshold to decide whether triangulation is result.degenerate
# (the rank is the number of singular values of the triangulation matrix which
# are larger than rankTolerance)
rankTolerance: 1
# /** landmarkDistanceThreshold
#   * if the landmark is triangulated at distance larger than this,
#   * result is flagged as degenerate.
#   */
landmarkDistanceThreshold: 10

# DynamicOutlierRejection:
#  /**
#   * If this is nonnegative the we will check if the average reprojection error
#   * is smaller than this threshold after triangulation, otherwise result is
#   * flagged as degenerate.
#   */
outlierRejection: 3
# ///< threshold to decide whether to re-triangulate
retriangulationThreshold: 0.001

## Noise models ##
smartNoiseSigma: 3.0
monoNoiseSigma: 1.8
monoNormType: 2
monoNormParam: 4.6851
stereoNoiseSigma: 1.8
stereoNormType: 2
stereoNormParam: 4.6851
regularityNoiseSigma: 0.03
regularityNormType: 1
regularityNormParam: 0.04

## Between Stereo Factors ##
addBetweenStereoFactors: 0
betweenRotationPrecision: 0 # Inverse of variance.
betweenTranslationPrecision: 100 # 1/(0.1*0.1)

# OPTIMIZATION PARAMETERS #####################################################
relinearizeThreshold: 0.01
relinearizeSkip: 1
zero_velocity_precision: 1000
no_motion_position_precision: 1000
no_motion_rotation_precision: 10000
constant_vel_precision: 100
numOptimize: 1
nr_states: 25 # number of nodes in horizon.
# ISAM2GaussNewtonParams: continue updating the linear delta only when
# changes are above this threshold (default: 0.001)
wildfire_threshold: 0.001
useDogLeg: 0

## NON PARSED PARAMS ##########################################################
#  bool enableEPI; ///< if set to true, will refine triangulation using LM
#  /**
#   * If this is nonnegative the we will check if the average reprojection error
#   * is smaller than this threshold after triangulation, otherwise result is
#   * flagged as degenerate.
#   */
#  double dynamicOutlierRejectionThreshold;

# Method used to generate the initial guess for the pose of the keyframe
# PoseGuessSource:
#   IMU = 0
#   MONO = 1
#   STEREO = 2
#   PNP = 3
#   EXTERNAL_ODOM = 4
pose_guess_source: 0
mono_translation_scale_factor: 0.1

# GRAPH TIME CENTRIC ADAPTER ################################################
use_graph_time_centric: 1

# Kimera-specific parameters for GraphTimeCentric (novel features not in standard VioBackend)
kimera:
  # ============================================================================
  # GP MOTION PRIORS
  # ============================================================================
  # Adds smoothness constraints on trajectory using Gaussian Process priors
  # Requires omega (angular velocity) from gyroscope measurements
  # 0 = disabled, 1 = enabled
  add_gp_motion_priors: 1
  
  # GP Model Type - all non-Full types can be combined without interference!
  # 0 = WNOA (White Noise on Acceleration) - simplest, uses omega only
  # 1 = WNOJ (White Noise on Jerk) - uses omega + acceleration measurements
  # 2 = WNOJFull - WNOJ with acceleration as optimized state (not implemented)
  # 3 = Singer - exponentially decaying acceleration model
  # 4 = SingerFull - Singer with acceleration as optimized state (not implemented)
  # 5 = WNOA+WNOJ - Both WNOA and WNOJ simultaneously
  # 6 = WNOA+Singer - WNOA plus Singer decay model
  # 7 = WNOA+WNOJ+Singer - All three models (maximum smoothing)
  #
  # Why combinations work:
  # - WNOA constrains acceleration to be white noise
  # - WNOJ constrains jerk (acceleration derivative) to be white noise
  # - Singer adds exponential decay constraint on acceleration
  # These are ADDITIVE regularization terms - they don't conflict!
  gp_model_type: 7
  
  # --------------------------------------------------------------------------
  # Qc Noise Model (used by all GP prior types)
  # --------------------------------------------------------------------------
  # Controls process noise / trajectory smoothness
  # Lower values = smoother trajectory, higher values = more flexibility
  qc_gp_trans_var: 1.0   # Translation variance (m^2/s^4) - for x, y, z
  qc_gp_rot_var: 0.1     # Rotation variance (rad^2/s^4) - for roll, pitch, yaw
  
  # --------------------------------------------------------------------------
  # Singer Model Parameters (used by types 3, 4, 6, 7)
  # --------------------------------------------------------------------------
  # Acceleration damping matrix (ad) - diagonal values
  # Controls how quickly acceleration decays toward zero: da/dt = -ad * a + noise
  # Higher values = faster decay (more aggressive return to zero acceleration)
  # Lower values = slower decay (more persistent acceleration allowed)
  # Units: 1/s (inverse time constant)
  ad_trans: 1.0          # Translation damping (x, y, z axes)
  ad_rot: 2.0            # Rotation damping (roll, pitch, yaw axes)
  
  # --------------------------------------------------------------------------
  # Full Variant Parameters (for future WNOJFull/SingerFull implementation)
  # --------------------------------------------------------------------------
  # These add acceleration as an optimized state variable (A keys)
  # Initial sigma for acceleration state priors
  initial_acc_sigma_trans: 0.5   # Translation acceleration sigma (m/s^2)
  initial_acc_sigma_rot: 0.1     # Rotation acceleration sigma (rad/s^2)

# FACTOR GRAPH DEBUG LOGGING #################################################
# Enable comprehensive factor graph logging when optimization fails
# Includes: factor keys, .g2o files, .dot graph visualizations
# Output is logged to Rerun and saved to debug_run_logs/
enable_factor_graph_debug_logging: 1

# smootherType - select which backend smoother to use:
# 0: ISAM2 (incremental nonlinear smoother, default)
# 1: Levenberg-Marquardt (batch nonlinear optimizer)
# 2: Gauss-Newton (batch nonlinear optimizer)
# 3: Dogleg (batch nonlinear optimizer)
# NOTE: Not all options may be supported in every build.
smootherType: 0

